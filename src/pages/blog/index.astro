---
import { NOTION_POSTS_DB } from "astro:env/server";
import { PostPreview } from "../../components/postPreview";
import "../../GlobalStyles.astro";
import { getPages } from "../../utils/DB";

// get all blog posts
const allPosts = await getPages({ databaseID: NOTION_POSTS_DB }).then((data) =>
  data.results
    //@ts-expect-error: Notion does not supply a full type coverage for it's tables
    .map(({ properties }) => {
      return {
        title: properties.Title.title[0].plain_text as string,
        slug: properties.Slug.rich_text[0].plain_text as string,
        image: properties.BannerImage.url as string,
        description: properties.Description.rich_text[0].plain_text as string,
      };
    })
    .reverse()
);

export const prerender = true;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Astro</title>
  </head>
  <body>
    <h1>My Astro Notion Landing Page!</h1>
    <h2>
      This website is a tamplate to check astro performences and banchmarks when
      using notion as a backend for writes and red, in addition it will be
      tested in ssr and ssg node
    </h2>
    <section>
      <h2>All posts page</h2>
      <h3>
        all the posts are fetched from notion and only key properties about the
        posts are shown here
      </h3>
      <ul>
        {allPosts.map((post) => <PostPreview {...post} />)}
      </ul>
    </section>
  </body>
</html>
